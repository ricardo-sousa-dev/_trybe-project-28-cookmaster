const chai = require('chai');
const chaiHttp = require('chai-http');
const sinon = require('sinon');
const { MongoClient } = require('mongodb');
const server = require('../api/app');
const connectionMock = require('./connectionMock');

const { expect } = chai;

describe('SERVER - Cookmaster', () => {
  let db;

  before(async () => {
    connection = await connectionMock();

    sinon.stub(MongoClient, 'connect')
      .resolves(connection);

    db = connection.db('Cookmaster');
    chai.use(chaiHttp);
  });

  it('Verifica se a conexão com o Cookmaster é realizada com sucesso', async () => {
    const response = await chai.request(server)
      .get('/');

    expect(db.namespace).to.equal('Cookmaster');
    expect(response).to.be.status(200);
    
  });
});